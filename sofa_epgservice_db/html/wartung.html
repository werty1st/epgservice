<script type="text/javascript" src="modules.js"></script>
<script type="text/javascript">
	$ = require('jquery');
	jQuery = $;
</script>
<script src="http://handsontable.com/dist/jquery.handsontable.full.js"></script>
<link rel="stylesheet" media="screen" href="http://handsontable.com/dist/jquery.handsontable.full.css">


<h1>EPG Data Service - Maintance</h1>



Alle Daten:
<table id="getall">
</table>


Alte Daten:
<div id="getold">
</div>


	
<script type="text/javascript">
    var db = require('db').use("epgservice");//current();
    var handlebars = require('handlebars');




    //http://localhost:5984/epgservice/_design/epgservice/_view/getAllWithAge_view
    db.getView('epgservice', 'getAllWithAge_view', function (err, data) {
        if (err || data.rows.length == 0) {
            // an error occurred
            $('#getall').append("keine Daten");
            return console.log(err);
        }
        console.log(data);
        add2table(data, '#getall');       
    });  

    db.getView('epgservice', 'getold_view', function (err, data) {
        if (err || data.rows.length == 0) {
            // an error occurred
            $('#getold').append("keine Daten");
            return console.log(err);
        }
        $('#getold').append(data);

    });  


    function getDetails(docid) {
	    //'_show/getByID_show/*', query: { accept: 'json'} }, 
	    db.getShow('epgservice', "getByID_show", docid,  { accept: 'json'}, function (err, data) {
	        if (err) {
	            // an error occurred
	            $('#detail').append("keine Daten");
	            return console.log(err);
	        }
	        console.log(data);
	        add2table(data, '#detail');       
	    });  
	}


    function add2table(data, tableid) {

    	var lastdata;

		for (var i=0;i<data.rows.length;i++) {
			var d = data.rows[i];
			var context = {};
				context.id= d.id;
				context.station = d.key[0];
				context.age = d.key[1];
				context.titel = d.value.titel;
				context.time = d.value.time;
				context.endtime = d.value.endTime;

			var html = handlebars.templates['table_line.html'](context);

			$(tableid).append(html);
		}

		// var $container = $(tableid);
		// $container.handsontable({
		// 	data: data.rows,
		// 	dataSchema: model,
		// 	startRows: 3,
		// 	startCols: 5,
		// 	colHeaders: ['ID', 'Name', 'Address'],
		// 	columns: [
		// 		{data: property("id")},
		// 		{data: property("name")},
		// 		{data: property("address")}
		// 	],	  
		// 	minSpareRows: 1
		// });		

    }

    


</script>



